# LASER FOREST





## HOW TO SET UP THE LASER FOREST 

First, create an image of the birds-eye view of the installation: Create a png file with a black background and white circles where the rods should be. (look at bin/data/layout for examples of roughly what this should look like). The program will scan this picture to work out the layout. Don't need to make it massive. If you change the file later on down the line, you will probably need to reassign the rods again.

Give your image a nice name and put it in bin/data/layout. Note that if the png has an alpha channel I don't think it'll work - in order to remove an alpha channel, open the image in Preview and save as png, untick the transparency option.

Open MLF-Forest.app in bin. 

Look at the UI down the left hand side, and look for the sub-heading "layout" (it should be 4th down the list under "Laser Forest".

Expand it pressing the "+" button. At the bottom of the expanded "layout" section, there should be a black box saying "image: ../../[some file name]". Click on that and select the name of your file, then press the little 's' button at the top of the "layout" section - this will save your settings.

The next step is to map the physical rods to their positions in the layout png.

Each board has a "deviceId" stored on it. The program can tell which deviceId's are on the network but needs to map them to "indexes" in the program. It makes up the index number by enumerating all the white circles it can see in the diagram. You can view the indexes or deviceId's by expanding the "display" menu and changing the "idDisplayType" dropdown.

Initially the "deviceId"s will all be wrong, the job is to make them all right.

This mapping from index to deviceId is stored in bin/data/layout/rodMap.txt. There is a "learn mode" in the program that allows you to not have to interact with this file but it's good to know how it works in case you have to fix a mistake. 

The rodMap.txt file is a list - each mapping on a new line, of deviceId to index. So each line starts with a deviceId, followed by a colon (:), followed by the index.

e.g.

127:4

means deviceId 127 corresponds to index 4 in the diagram.

There should be an entry on the list for each rod.

### LEARN MODE

If you scroll right to the bottom of the UI, there's a section called "comms". If you expand it, you'll see there is a checkbox called "learnMode"

WARNING: all rods need to be vertical for this to work.

The idea is, in learn mode, you choose a rod with the mouse on the screen, then hit the corresponding rod in the physical space, and the program will look for the rod that seems to be wobbling the most (according to its accelerometer), and map the deviceId of that board to the currently selected rod in the gui. If there are any really wobbly rods, it could break this. 

This is how to do the mapping:

1. enable the learnMode checkbox.

2. Select a rod by clicking it in the gui. You need to click it at the bottom of the rod to properly select it (it should go yellow, and you should see a text summary of it in the bottom right hand corner of the program)

3. Go and give that rod a wallop.

4. Check that the deviceId has changed.

5. Go to number 2 and select the next rod. You can '.' and ',' keys to select next or previous rod instead of using the mouse if you like.

6. press 's' to save the configuration, and make backups of rodMap.txt along the way.

7. Disable learnMode. press 's' to save.







## MAKING PRESETS

Start on default.xml. Do this by pressing the little "l" next to the "Laser Forest" heading in the UI and choose "default.xml" - this contains all the base settings for the laser calibration etc.

Now you can fiddle with the settings, then save by pressing the little "s" next to the "Laser Forest" heading, press "<CREATE NEW>" then give it a name - don't put a ".xml" on the name.


### Video playback:

Expand the "animation" section then expand "laser" inside that. The first item is a dropdown that lets you choose a video - these need to be in openframeworks/apps/mlf/MLF-Forest/bin/data/animations/laser/

You must select the loop option in the GUI to make it loop.


### Always on:

In the main laser section, there's an option called "alwaysOn" - this will turn all the lasers on all the time.






## THE SEQUENCER

Once you have made some presets, you can make the sequence that just runs in a loop. This is configured with openframeworks/apps/mlf/MLF-Forest/bin/data/sequence.xml

In here you can add as many <events> as you want and it'll play though them unless you press pause. The presetName needs to be exactly the name of the preset you made (without the ".xml"). DO NOT EDIT THIS FILE WITH THE PROGRAM RUNNING.





## TROUBLESHOOTING

If there is a problem with one of the rods and you need to replace a board, the best thing to do is this

1. Back everything up!!

2. Find the "index" of the board you want to replace. You do this by using the dropdown called "idDisplayType" in the app in the "display" section of the GUI. Flip it to "index". 

3. In the visualization, find the rod you want to replace (it helps to press tab to hide the rod accelerometer readings). It's quite difficult to tell which number corresponds to which rod so feel free to adjust the camera position using the sliders in the "camera" section of the app.

4. Get a new board out, and plug it in on its own into one of the networks, then restart the app, and you can read off the deviceId of the board when it comes up (it'll be the only one on its network.)

5. Now you have the "index" of the rod (i.e. the id of the position in the installation) and the "deviceId" of the new board, open the file openframeworks/apps/mlf/MLF-Forest/bin/data/layout/rodMap.txt and find the line that ends with the same index as the rod you want to swap the board with (i.e. the number after the colon). Change the first number on that line to the new deviceId. 

6. Start the program again, it should now be correctly remapped.



## BACKING UP

open terminal.

cd openFrameworks/apps/mlf/MLF-Forest

git add .
git commit -m "your meaningful git message"
git pull
git push

When doing "git pull" it might open up a text file in vi (a unix text editor) to let you write a commit message. To get out of this, press ":wq" and then hit enter.













